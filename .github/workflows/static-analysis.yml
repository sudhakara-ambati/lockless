name: Static Analysis

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  clang-tidy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Install clang-tidy
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-tidy
        
    - name: Run analysis
      run: |
        clang-tidy include/lockless.h examples/test1.cpp \
          --checks='-*,readability-*,performance-*' \
          -- -std=c++17 -I include -D_WIN32
      continue-on-error: true