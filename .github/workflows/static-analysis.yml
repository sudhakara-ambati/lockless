name: Static Analysis

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  clang-tidy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Install clang-tidy
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-tidy
        
    - name: Analyze framework header
      run: |
        clang-tidy include/lockless.h \
          --checks='-*,performance-*,readability-*,modernize-use-nullptr' \
          -- -std=c++17 -D_WIN32 -x c++-header
      continue-on-error: true
      
    - name: Analyze framework implementation
      run: |
        clang-tidy src/lockless.cpp \
          --checks='-*,performance-*,readability-*,modernize-use-nullptr' \
          -- -std=c++17 -I include -D_WIN32
      continue-on-error: true